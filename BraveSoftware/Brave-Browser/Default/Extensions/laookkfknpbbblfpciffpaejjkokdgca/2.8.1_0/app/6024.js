"use strict";(globalThis.webpackChunkmomentum=globalThis.webpackChunkmomentum||[]).push([[6024],{35757:(e,t,s)=>{var i;s.d(t,{DY:()=>r,OL:()=>o,S9:()=>i,iW:()=>d,sY:()=>n}),function(e){e.List="list"}(i||(i={}));const o=["tabs","sessions"],n={ERROR_STASH:"Oops, we couldn't save that session at this time.",ERROR_RESTORE:"Oops, we couldn't restore that session at this time.",ERROR_NO_OTHER_TABS:"No tabs to stash.",ERROR_DELETE:"Oops, there was a problem deleting that session.",ERROR_ALL_DELETE:"Oops, there was a problem deleting all sessions.",SUCCESSFUL_STASH_PARTIAL:" saved to a new session.",SUCCESSFUL_RESTORE_PARTIAL:" session restored.",SUCCESSFUL_ALL_DELETE:"All session deleted.",DELETE_PARTIAL:" session deleted."},r="chrome://newtab/",d="https://get.momentumdash.help/hc/en-us/articles/14474141114391"},36024:(e,t,s)=>{s.r(t),s.d(t,{makeTabsStore:()=>g,useTabsStore:()=>S});var i,o=s(28692),n=s(74957);class r{constructor({key:e,title:t,url:s,pinned:o,index:n}){this.type=i.Tab,this.key=e,this.title=t,this.url=s,this.pinned=o,this.index=n}}class d{constructor({key:e,tabs:t,index:s,color:o="grey",title:n="",collapsed:d=!1}){this.type=i.Group,this.key=e,this.index=s,this.tabs=t.map((e=>new r(e))),this.color=o,this.title=n,this.collapsed=d}}!function(e){e.Tab="Tab",e.Group="Group"}(i||(i={}));class a{constructor({key:e,activeTabKey:t,state:s,type:i,left:o,top:n,width:a,height:c,browserSessionKey:l,tabsAndGroups:u}){this.tabsAndGroups=[],this.key=e,this.activeTabKey=t,this.state=s,this.type=i,this.left=o,this.top=n,this.width=a,this.height=c,l&&(this.browserSessionKey=l),this.tabsAndGroups=u.map((e=>"tabs"in e?new d(e):new r(e)))}get tabCount(){let e=0;return this.tabsAndGroups.forEach((t=>{e+=t instanceof r?1:t.tabs.length})),e}}const c=e=>!("object"!=typeof e||!e)&&Object.entries({key:"number",state:"string",type:"string",left:"number",top:"number",width:"number",height:"number"}).every((([t,s])=>t in e&&typeof e[t]===s));class l{constructor({id:e,name:t,windows:s,activeWindowKey:i,browser:o,dateCreated:n}){this.windows=[],this.id=e,this.name=t,this.windows=s.map((e=>new a(e))),this.activeWindowKey=i,this.browser=o,this.dateCreated=n}get totalTabCount(){return this.windows.map((e=>e.tabCount)).reduce(((e,t)=>e+t))}get displayName(){return this.name||n.Z.getFriendlyDateTime(new Date(this.dateCreated))}}var u=s(77140),h=s(35757),w=function(e,t,s,i){return new(s||(s=Promise))((function(o,n){function r(e){try{a(i.next(e))}catch(e){n(e)}}function d(e){try{a(i.throw(e))}catch(e){n(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(r,d)}a((i=i.apply(e,t||[])).next())}))},p=function(e,t){var s={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(s[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(i=Object.getOwnPropertySymbols(e);o<i.length;o++)t.indexOf(i[o])<0&&Object.prototype.propertyIsEnumerable.call(e,i[o])&&(s[i[o]]=e[i[o]])}return s};class y{constructor(e){this.dataService=e}get(e){this.dataService.get(e)}create(e){return this.dataService.create(e.id,e)}update(e,t,s={}){return this.dataService.update(e,t,s)}delete(e){return this.dataService.delete(e)}ensurePermissions(){return w(this,void 0,void 0,(function*(){return!!(yield u.H.permissions.contains(h.OL))||new Promise((e=>{m.cmd("modal.open","PERMISSION_REQUEST",{title:"Tab Stash requires additional permissions",description:"In order to save and restore your tabs, we require these additional permissions.",permissions:h.OL,resolve:e})}))}))}renameIdToKey(e){var{id:t}=e,s=p(e,["id"]);return Object.assign(Object.assign({},s),{key:t})}closeWindowsAndSetSessionIds(e){return w(this,void 0,void 0,(function*(){for(const t of e.windows){yield u.H.windows.remove(t.key);const e=yield u.H.sessions.getLastClosedSessionId().catch((e=>{console.error(e)}));e&&(t.browserSessionKey=e)}return e}))}restoreSession(e){return w(this,void 0,void 0,(function*(){const t=e.windows.filter((t=>t.key!==e.activeWindowKey)),s=e.windows.filter((t=>t.key===e.activeWindowKey)),i=yield u.H.tabs.query({currentWindow:!0}),o=i.find((e=>e.active));if(!o||!o.id)throw new Error("Could not find active tab id from current window");let n=o.windowId;for(const r of[...t,...s]){const t=yield this.restoreWindow(r,e.browser);r.key===e.activeWindowKey&&1===i.length&&t.id&&(o.pinned&&(yield u.H.tabs.update(o.id,{pinned:!1})),yield u.H.tabs.moveToWindow(o.id,t.id),n=t.id,o.pinned&&(yield u.H.tabs.update(o.id,{pinned:!0})))}yield this.focusTabAndWindow(o.id,n)}))}getSessionFromWindows(){return w(this,void 0,void 0,(function*(){const e=yield u.H.tabs.query({currentWindow:!0}),t=e.find((e=>e.active));let s=-1;if(t&&1!==e.length&&t.id){const e=t.id;s=t.windowId,yield u.H.windows.create({tabId:e}),t.pinned&&(yield u.H.tabs.update(e,{pinned:!0}))}const i={id:n.Z.uuidv4(),name:"",windows:[],activeWindowKey:s,browser:this.getCurrentBrowserOrigin(),dateCreated:(new Date).toISOString()},o=yield u.H.windows.getAll();for(let e of o)if(!e.focused){if(e=this.renameIdToKey(e),!c(e))throw new Error(`window returned by browser (${i.browser}) does not satisfy IWindow type`);yield this.setTabsDataForWindow(e,i.browser),i.windows.push(e)}return new l(i)}))}setTabsDataForWindow(e,t){var s,o;return w(this,void 0,void 0,(function*(){const n=(yield u.H.tabs.query({windowId:e.key})).map((e=>{if(Object.assign(e,{type:i.Tab}),e=this.renameIdToKey(e),"object"!=typeof(s=e)||!s||!Object.entries({key:"number",title:"string",url:"string",pinned:"boolean",index:"number"}).every((([e,t])=>e in s&&typeof s[e]===t))||s.type!==i.Tab)throw new Error(`tab returned by browser (${t}) does not satisfy ITab type`);var s;return[e.url,t+"://newtab/"].includes(window.location.href)&&(e.url=h.DY),e})),r=[];e.activeTabKey=(null===(s=n.find((e=>e.active)))||void 0===s?void 0:s.id)||-1;for(let e=0;e<n.length;e++){const t=n[e];if(t)if(~t.groupId&&void 0!==t.groupId){const s={key:t.groupId,index:0,type:i.Group,tabs:n.filter((e=>e.groupId===t.groupId))};s.index=Number(null===(o=s.tabs[0])||void 0===o?void 0:o.index),e+=s.tabs.length-1,r.push(s)}else r.push(t)}e.tabsAndGroups=r}))}restoreWindow(e,t){return w(this,void 0,void 0,(function*(){const s=e.browserSessionKey;let i;return s&&(i=yield u.H.sessions.restoreWindow(s)),i||(i=yield this.fallbackRestoreWindow(e,t)),i}))}fallbackRestoreWindow(e,t){var s,i,o,n,a;return w(this,void 0,void 0,(function*(){let c;const l={},{tabsAndGroups:h,activeTabKey:w,key:m,browserSessionKey:y}=e,v=p(e,["tabsAndGroups","activeTabKey","key","browserSessionKey"]),b=h.map((e=>e instanceof r?[e]:e.tabs)).flat();if(Object.assign(l,v),l.url=this.getUrlArrayForWindowCreateFromTabs(b,t),["maximized","minimized","fullscreen"].includes(e.state)&&["width","height","left","top"].forEach((e=>delete l[e])),c=yield u.H.windows.create(l),c||(["left","top"].forEach((e=>delete l[e])),c=yield u.H.windows.create(l)),c||(["width","height"].forEach((e=>delete l[e])),c=yield u.H.windows.create(l)),!c)throw new Error("Could not create window");if(void 0!==chrome.tabs.group)for(const e of h){if(!(e instanceof d))continue;const t=e.index,i=t+e.tabs.length,o={tabIds:null===(s=c.tabs)||void 0===s?void 0:s.slice(t,i).map((e=>e.id)),createProperties:{windowId:c.id}};yield u.H.tabs.group(o)}for(let e=0;e<b.length;e++){const t=b[e];if(null==t?void 0:t.pinned){const t=null===(o=null===(i=c.tabs)||void 0===i?void 0:i[e])||void 0===o?void 0:o.id;if(!t)continue;yield u.H.tabs.update(t,{pinned:!0})}}const f=b.find((e=>e.key===w));if(f){const e=b.indexOf(f),t=null===(a=null===(n=c.tabs)||void 0===n?void 0:n[e])||void 0===a?void 0:a.id;t&&(yield u.H.tabs.update(t,{active:!0}))}return c}))}getUrlArrayForWindowCreateFromTabs(e,t){const s=e=>e.startsWith(t+"-extension://")||e.startsWith(t+"://"),i=e.map((e=>e.url===h.DY&&n.Z.isFirefox()?"/dashboard.html":s(e.url)?e.url.replace(t,this.getCurrentBrowserOrigin()):e.url)).filter((e=>!(s(e)&&n.Z.isFirefox()||e.startsWith("about:"))));return 0===i.length&&i.push("/dashboard.html"),i}getCurrentBrowserOrigin(){return window.location.href.split("-")[0]||"chrome"}focusTabAndWindow(e,t){return w(this,void 0,void 0,(function*(){e&&(yield u.H.tabs.update(e,{active:!0})),t&&(yield u.H.windows.update(t,{focused:!0}))}))}}var v=s(34145),b=s(20144),f=function(e,t,s,i){return new(s||(s=Promise))((function(o,n){function r(e){try{a(i.next(e))}catch(e){n(e)}}function d(e){try{a(i.throw(e))}catch(e){n(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(r,d)}a((i=i.apply(e,t||[])).next())}))};const g=(e=(()=>({tabStashService:new y(new v.U("tabs"))}))().tabStashService)=>(0,o.Q_)("tabs",{state:()=>({data:{},loading:!1,loaded:!1,activeItemId:""}),getters:{getItems:e=>Object.values(e.data).map((e=>new l(e))).sort(((e,t)=>Date.parse(t.dateCreated)-Date.parse(e.dateCreated))),getItemById:e=>t=>{const s=e.data[t];return s?new l(s):null}},actions:{refresh(){this.loading=!0,e.get({success:e=>{e.forEach((e=>b.ZP.set(this.data,e.id,e))),this.loaded=!0,this.loading=!1}})},stashSession(){return f(this,void 0,void 0,(function*(){if(!(yield e.ensurePermissions()))return;const t=yield e.getSessionFromWindows();return 0===t.windows.length||(yield this.create(t),yield e.closeWindowsAndSetSessionIds(t),yield this.update(t.id,{windows:t.windows})),t}))},restoreSession(t){return f(this,void 0,void 0,(function*(){if(yield e.ensurePermissions())return yield e.restoreSession(t),yield this.delete(t.id),!0}))},create(t){return f(this,void 0,void 0,(function*(){b.ZP.set(this.data,t.id,t),yield e.create(t)}))},delete(t){return f(this,void 0,void 0,(function*(){b.ZP.delete(this.data,t),yield e.delete(t)}))},update(t,s){return f(this,void 0,void 0,(function*(){const i=this.data[t];if(!i)throw new Error(`No data found for ${t}`);const o=Object.assign(Object.assign({},i),s);b.ZP.set(this.data,t,o);const n=Object.keys(s).join(",");return yield e.update(t,o,{queryParams:{update_mask:n}}),o}))}}}),S=g()},77140:(e,t,s)=>{s.d(t,{H:()=>o});var i=s(74957);const o={tabs:{query:e=>new Promise((t=>chrome.tabs.query(e,t))),update:(e,t)=>new Promise((s=>chrome.tabs.update(e,t,s))),group:e=>new Promise((t=>chrome.tabs.group(e,t))),move:(e,t)=>new Promise((s=>chrome.tabs.move(e,t,s))),moveToWindow:(e,t)=>{return s=void 0,i=void 0,r=function*(){e&&t&&(yield o.tabs.move(e,{windowId:t,index:-1}))},new((n=void 0)||(n=Promise))((function(e,t){function o(e){try{a(r.next(e))}catch(e){t(e)}}function d(e){try{a(r.throw(e))}catch(e){t(e)}}function a(t){var s;t.done?e(t.value):(s=t.value,s instanceof n?s:new n((function(e){e(s)}))).then(o,d)}a((r=r.apply(s,i||[])).next())}));var s,i,n,r}},windows:{create:e=>new Promise((t=>chrome.windows.create(e,t))),remove:e=>new Promise((t=>{const s=()=>{chrome.sessions.onChanged.removeListener(s),t()};chrome.sessions.onChanged.addListener(s),chrome.windows.remove(e,(()=>{}))})),update:(e,t)=>new Promise((s=>chrome.windows.update(e,t,s))),get:e=>new Promise((t=>chrome.windows.get(e,{},t))),getAll:()=>new Promise((e=>chrome.windows.getAll(e)))},sessions:{restoreWindow:e=>new Promise((t=>chrome.sessions.restore(e,(e=>{(null==e?void 0:e.window)?t(null==e?void 0:e.window):(null==e?void 0:e.tab)?chrome.windows.get(e.tab.windowId||0,{},t):t(void 0)})))),getRecentlyClosedWindowSessionIds:()=>new Promise((e=>chrome.sessions.getRecentlyClosed({},(t=>{const s=[];t.forEach((e=>{var t;"window"in e&&(null===(t=e.window)||void 0===t?void 0:t.sessionId)&&s.push(e.window.sessionId)})),e(s)})))),getLastClosedSessionId:()=>new Promise((e=>chrome.sessions.getRecentlyClosed({maxResults:1},(t=>{var s,i,o,n;const r=(null===(i=null===(s=t[0])||void 0===s?void 0:s.window)||void 0===i?void 0:i.sessionId)||(null===(n=null===(o=t[0])||void 0===o?void 0:o.tab)||void 0===n?void 0:n.sessionId);if(!r)throw new Error("Could not get session ID from closed window");e(r)}))))},permissions:{request:e=>new Promise((t=>{i.Z.isFirefox()?i.Z.getBrowser().permissions.request({permissions:e}).then(t):chrome.permissions.request({permissions:e},t)})),contains:e=>new Promise((t=>{i.Z.isFirefox()?i.Z.getBrowser().permissions.contains({permissions:e}).then(t):chrome.permissions.contains({permissions:e},t)}))}}},34145:(e,t,s)=>{s.d(t,{U:()=>n});var i=s(42935);const o=s(24960).Z;class n{constructor(e,{queryParams:t={},path:s="",mode:i="sync"}={}){this.type=e,this.queryParams=t,this.path=s,this.mode=i}get({path:e=this.path||this.type,mode:t=this.mode,success:s,failure:i,queryParams:n={}}){var r;e+=this.buildQueryString((null===(r=this.queryParams)||void 0===r?void 0:r.get)||{},n);const d=[this.type,{path:e,env:this.getEnv(),mode:t}];"server"===t?o.sendMessage({handler:"get",args:d}).then(s).catch(i):o.sendRecurringCrossTabMessage({msgId:this.type+":refreshed",handler:"get",args:d,success:s,failure:i})}create(e,t,{path:s=this.path||this.type,mode:i=this.mode}={}){const n=[this.type,e,t];return n.push({path:s,mode:i,env:this.getEnv()}),o.sendMessage({handler:"create",args:n})}update(e,t,{path:s=this.path||this.type,mode:i=this.mode,queryParams:n={}}={}){var r;const d=this.buildQueryString((null===(r=this.queryParams)||void 0===r?void 0:r.update)||{},n),a=[this.type,e,t];return a.push({path:s,mode:i,env:this.getEnv(),queryString:d}),o.sendMessage({handler:"update",args:a})}delete(e,{path:t=this.path||this.type,mode:s=this.mode}={}){const i=[this.type,e];return i.push({path:t,mode:s,env:this.getEnv()}),o.sendMessage({handler:"delete",args:i})}getEnv(){return{token:localStorage.getItem("token"),clientUuid:localStorage.getItem("client_uuid"),apiUrl:m.globals.urlRootApi,version:m.globals.version,tabId:i.Z}}buildQueryString(...e){const t=new URLSearchParams(Object.assign({},...e)).toString();return t?"?"+t:""}}}}]);